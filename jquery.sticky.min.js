/**
 * Sticky
 * 
 * Keep interface elements fixed in place as the user scrolls.
 * 
 * Copyright (c) 2012 Kevin Thompson <http://kevinthompson.info>
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 * @author:   Kevin Thompson <kevin@kevinthompson.info>
 * @link:     https://github.com/kevinthompson/jquery.sticky.js
 * @version:  1.1
**/ 
;(function(a){a.fn.sticky=function(b){var c={offset:20,mode:"fixed",stopper:"",speed:500,classes:{element:"jquery-sticky-element",start:"jquery-sticky-start",sticky:"jquery-sticky-sticky",stopped:"jquery-sticky-stopped",placeholder:"jquery-sticky-placeholder"},onStick:"",onStart:"",onStop:""};this.each(function(){if(b)a.extend(c,b);if(a(this).parent().hasClass(c.classes.element))return;var d={init:function(b){c.mode=a.browser.msie&&c.mode=="fixed"?c.mode="animate":c.mode;d.element=b.wrap('<div class="'+c.classes.element+'" />').parent();d.units={start:d.element.offset().top};c.states=[c.classes.start,c.classes.sticky,c.classes.stopped].join(" ");if(c.stopper!=""){var e=a(c.stopper),f;if(e.length>0){for(i=0;i<e.length&&typeof d.stopper=="undefined";i++){if(a(e[i]).offset().top>d.element.offset().top+d.element.outerHeight(false)){d.stopper=a(e[i])}}}if(typeof d.stopper!="undefined"&&d.stopper.length>0){f=parseInt(d.stopper.css("margin-top"))||0;d.units.stop=d.stopper.offset().top-f}}d.placeholder=d.element.clone().empty().attr("class",c.classes.placeholder).css({opacity:0,height:d.element.height()}).insertBefore(d.element);d.element.appendTo("body").css({width:d.placeholder.width(),left:d.placeholder.offset().left,top:d.placeholder.offset().top,"margin-bottom":"0px",position:"absolute","z-index":"999"});a(window).bind("resize scroll",function(){d.update()});d.update()},update:function(){var b;d.element.css({width:d.placeholder.width(),left:d.placeholder.offset().left});d.placeholder.css("height",d.element.height());d.units.start=d.placeholder.offset().top;if(d.element.outerHeight(false)+c.offset<a(window).height()){d.units.doctop=a(document).scrollTop();if(d.element.hasClass(c.classes.sticky)&&c.mode=="animate"){d.animate(d.units.doctop+c.offset)}if(typeof d.stopper!="undefined"&&d.stopper.length>0){b=parseInt(d.stopper.css("margin-top"))||0;d.units.stop=d.stopper.offset().top-b}if(!d.element.hasClass(c.classes.stopped)&&typeof d.stopper!="undefined"&&d.stopper.length>0&&d.units.doctop+c.offset+d.element.outerHeight(false)>=d.units.stop){d.stop(d.units.stop-d.element.outerHeight(false),"stop");if(typeof c.onStop=="function")c.onStop()}else if(!d.element.hasClass(c.classes.sticky)&&d.units.doctop>d.units.start-c.offset&&(typeof d.stopper=="undefined"||d.stopper.length==0||d.stopper.length>0&&d.units.doctop+c.offset+d.element.outerHeight(false)<d.units.stop)){d.stick(c.offset);if(c.mode=="animate")d.animate(d.units.doctop+c.offset);if(typeof c.onStick=="function")c.onStick()}else if(d.units.doctop<=d.units.start-c.offset){d.stop(d.units.start,"start");if(typeof c.onStart=="function")c.onStart()}}else if(!d.element.hasClass(c.classes.start)){d.stop(d.units.start,"start")}},animate:function(a){clearTimeout(d.timer);d.timer=setTimeout(function(){if(a>=d.units.stop){a=d.units.stop-d.element.outerHeight(false)}else if(a<=d.units.start){a=d.units.start}d.element.stop().animate({top:a},c.speed)},100)},stick:function(a){d.element.removeClass(c.states).addClass(c.classes.sticky);if(c.mode=="fixed"){d.element.css({top:a,position:"fixed"})}},stop:function(a,b){d.element.removeClass(c.states).addClass(b=="start"?c.classes.start:c.classes.stopped);if(c.mode=="fixed"){d.element.css({top:a,position:"absolute"})}else{d.animate(b=="start"?d.units.start:d.units.stop-d.element.outerHeight(false))}}};d.init(a(this))})}})(jQuery)